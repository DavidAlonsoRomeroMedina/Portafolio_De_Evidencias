<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Simbólica Profesional</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    <style>
        /* --- ESTILOS GENERALES Y PROFESIONALES --- */
        :root {
            --primary-color: #B4141E; /* Color solicitado */
            --primary-dark: #8a0f16;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #333333;
            --border-radius: 8px;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; /* Fuente profesional */
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 850px;
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); /* Sombra suave y moderna */
            border-top: 5px solid var(--primary-color); /* Detalle de diseño */
        }

        /* --- TIPOGRAFÍA --- */
        h1 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 10px;
            text-align: center;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-decoration: none; /* Quitamos el subrayado antiguo */
        }

        h2 {
            color: #444;
            font-size: 1.4rem;
            border-left: 5px solid var(--primary-color);
            padding-left: 15px;
            margin-top: 40px;
            margin-bottom: 20px;
            text-decoration: none;
        }

        p {
            color: #666;
            font-size: 0.95rem;
            margin-bottom: 15px;
        }

        hr {
            border: 0;
            height: 1px;
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0));
            margin: 40px 0;
        }

        /* --- INPUTS MEJORADOS --- */
        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #222;
        }

        input[type="text"], 
        input[type="number"] {
            width: 100%;
            padding: 15px; /* Tamaño aumentado */
            font-size: 1.1rem;
            font-family: 'Segoe UI', sans-serif; /* Mismo estilo que el texto */
            border: 2px solid #e1e1e1;
            border-radius: var(--border-radius);
            background-color: #fafafa;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        input[type="text"]:focus, 
        input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-color);
            background-color: #fff;
            box-shadow: 0 0 0 4px rgba(180, 20, 30, 0.1);
        }

        /* --- BOTONES PROFESIONALES --- */
        button {
            background-color: var(--primary-color);
            color: white;
            padding: 14px 28px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            width: 100%; /* Botón ancho completo para modernidad */
            text-transform: uppercase;
            font-family: inherit;
            box-shadow: 0 4px 6px rgba(180, 20, 30, 0.2);
        }

        button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(1px);
        }

        /* --- RESULTADOS --- */
        .result-box {
            margin-top: 25px;
            background: #fff;
            border-radius: var(--border-radius);
        }

        .result-box:empty {
            display: none;
        }

        .formula-original {
            background-color: #f8f9fa;
            border-left: 4px solid #555;
            padding: 15px;
            color: #333;
            margin-bottom: 20px;
            font-family: 'Consolas', monospace; /* Solo aquí usamos monospace para la mate */
        }

        /* Tabla estilizada profesionalmente */
        .result-box table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border: 1px solid #e1e1e1;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .result-box table thead {
            background-color: var(--primary-color);
            color: white;
        }

        .result-box table th,
        .result-box table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e1e1e1;
        }

        .result-box table th {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        .result-box table tbody tr:last-child td {
            border-bottom: none;
        }

        .result-box table tbody tr:hover {
            background-color: #fff5f5; /* Un rojo muy muy pálido al pasar el mouse */
        }

        .result-box pre {
            margin: 0;
            font-family: 'Consolas', monospace;
            font-size: 1.1em;
            color: #222;
        }

        .error-message {
            color: var(--primary-color);
            background-color: #ffebeb;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 15px;
            border: 1px solid #ffcdcd;
            display: none; /* Oculto por defecto */
        }
        
        .error-message:not(:empty) {
            display: block;
        }

        .nota-didactica {
            margin-top: 20px;
            padding: 15px;
            background-color: #eef7ff;
            border-left: 4px solid #2196F3; /* Azul profesional para notas informativas */
            color: #0d47a1;
            font-size: 0.9rem;
            border-radius: 4px;
        }

        /* --- FOOTER --- */
        footer {
            margin-top: 50px;
            text-align: center;
            font-size: 0.85rem;
            color: #888;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        
        footer strong {
            color: var(--primary-color);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container { padding: 20px; }
            h1 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Sistema de Cálculo Simbólico</h1>
        <p style="text-align: center;">Herramienta académica para el despeje de ecuaciones lineales y fórmulas literales.</p>

        <section class="solver-section">
            <h2>1. Resolución de Ecuaciones (Variable X)</h2>
            <p>Ingrese una ecuación lineal para determinar el valor de <strong>x</strong>.</p>
            
            <div class="input-group">
                <input type="text" id="ecuacion" value="2x + 3 = x + 8" placeholder="Ej: 3x - 5 = 10">
            </div>
            
            <button onclick="resolverEcuacionParseada()">Calcular Solución</button>
            
            <div id="mensajeError" class="error-message"></div>
            <div id="resDespejeParseado" class="result-box"></div>
        </section>

        <hr>

        <section class="solver-section">
            <h2>2. Despeje de Fórmulas Literales</h2>
            <p>Ingrese una fórmula matemática para generar los despejes de todas sus variables.</p>
            
            <div class="input-group">
                <label for="formulaLiteral">Fórmula Base:</label>
                <input type="text" id="formulaLiteral" value="C = 5(F - 32)/9" placeholder="Ej: V = d/t">
            </div>
            
            <button onclick="procesarFormulaLiteral()">Generar Despejes</button>

            <div id="mensajeErrorFormula" class="error-message"></div>
            <div id="resFormulaLiteral" class="result-box"></div>
        </section>

        <footer>
            TSU en Desarrollo de Software • Tecnológico de Software<br>
            Fundamentos de Álgebra • 1° Cuatrimestre 2025 • Grupo 1-C<br>
            <strong>Alumno: David Romero</strong> • Docente: Jorge Javier Pedroza Romero
        </footer>
    </div>

<script>
    // --- LÓGICA DE JAVASCRIPT (Funcionalidad Original Preservada) ---
    
    // Utilidad para limpiar strings
    function cleanString(str) {
        return str.replace(/\s+/g, '');
    }

    // --- PARTE 1: Solución de Ecuaciones de una Variable (x) ---
    function resolverEcuacionParseada() {
        const ecuacionStr = document.getElementById('ecuacion').value;
        const resBox = document.getElementById('resDespejeParseado');
        const errorBox = document.getElementById('mensajeError');

        resBox.innerHTML = '';
        errorBox.innerText = '';

        try {
            const partes = ecuacionStr.split('=');
            if (partes.length !== 2) throw new Error("La ecuación debe contener exactamente un signo '='");

            const ladoIzq = partes[0].trim();
            const ladoDer = partes[1].trim();
            const ecuacionFormateada = `(${ladoIzq}) - (${ladoDer})`;

            const nodo = math.parse(ecuacionFormateada);
            const simplificado = math.simplify(nodo);

            const coeficientes = extraerCoeficientes(simplificado.toString());
            const solucion = -coeficientes.b / coeficientes.a;

            // HTML formateado para el nuevo diseño
            resBox.innerHTML = `
                <div class="formula-original">
                    Ecuación Original: ${ecuacionStr}
                </div>
                <div style="padding: 20px; text-align: center; border: 1px solid #eee; border-radius: 8px;">
                    <p style="font-size: 1.2rem; color: #B4141E; font-weight: bold; margin: 0;">x = ${solucion}</p>
                    <small style="color: #666; display: block; margin-top: 10px;">Forma simplificada: ${simplificado.toString()} = 0</small>
                </div>
            `;
        } catch (error) {
            errorBox.innerText = `Error: ${error.message}`;
        }
    }

    function extraerCoeficientes(ecuacion) {
        ecuacion = ecuacion.replace(/\s+/g, '');
        let a = 0; 
        let b = 0; 
        const regexX = /([+-]?\d*\.?\d*)\*?x/g;
        let match;
        while ((match = regexX.exec(ecuacion)) !== null) {
            let coef = match[1];
            if (coef === '' || coef === '+') coef = '1';
            if (coef === '-') coef = '-1';
            a += parseFloat(coef);
        }
        const sinX = ecuacion.replace(/[+-]?\d*\.?\d*\*?x/g, '');
        if (sinX) {
            try { b = math.evaluate(sinX); } catch (e) { b = 0; }
        }
        return { a, b };
    }

    // --- PARTE 2: Despeje Simbólico de Fórmulas ---
    function extractVariables(formulaStr) {
        const matches = formulaStr.match(/[a-zA-Z][a-zA-Z0-9]*/g);
        if (!matches) return [];
        return Array.from(new Set(matches));
    }

    function despejarVariable(expresionOriginal, variableObjetivo, variableDespejada) {
        try {
            let expresion = expresionOriginal.replace(/\s+/g, '');
            const patronComplejo = /(\d*\.?\d*)\(([a-zA-Z]+)\s*([+-])\s*(\d+\.?\d*)\)\s*\/\s*(\d+\.?\d*)/;
            const matchComplejo = expresion.match(patronComplejo);

            if (matchComplejo && matchComplejo[2] === variableObjetivo) {
                const coef1 = matchComplejo[1] || '1';
                const operador = matchComplejo[3];
                const constante = matchComplejo[4];
                const divisor = matchComplejo[5];
                const operadorInverso = operador === '-' ? '+' : '-';
                if (coef1 === '1') {
                    return `(${variableDespejada}) * (${divisor}) ${operadorInverso} ${constante}`;
                } else {
                    return `(${variableDespejada}) * (${divisor}) / (${coef1}) ${operadorInverso} ${constante}`;
                }
            }

            if (expresion.includes('+') || expresion.includes('-')) {
                const resultado = despejarSumaResta(expresion, variableObjetivo, variableDespejada);
                if (resultado !== null) return resultado;
            }

            if (expresion.includes('/')) {
                const partes = dividirPorOperadorPrincipal(expresion, '/');
                const numerador = partes[0];
                const denominador = partes[1];
                if (numerador.includes(variableObjetivo)) {
                    if (numerador === variableObjetivo) {
                        return `(${variableDespejada}) * (${denominador})`;
                    } else {
                        const factoresNum = extraerFactoresMultiplicacion(numerador);
                        const otrosFactores = factoresNum.filter(f => f !== variableObjetivo);
                        if (otrosFactores.length === 0) return `(${variableDespejada}) * (${denominador})`;
                        else return `(${variableDespejada}) * (${denominador}) / (${otrosFactores.join(' * ')})`;
                    }
                } else if (denominador.includes(variableObjetivo)) {
                    if (denominador === variableObjetivo) {
                        return `(${numerador}) / (${variableDespejada})`;
                    } else {
                        const factoresDen = extraerFactoresMultiplicacion(denominador);
                        const otrosFactores = factoresDen.filter(f => f !== variableObjetivo);
                        if (otrosFactores.length === 0) return `(${numerador}) / (${variableDespejada})`;
                        else return `(${numerador}) / ((${variableDespejada}) * (${otrosFactores.join(' * ')}))`;
                    }
                }
            }

            if (expresion.includes('*')) {
                const factores = extraerFactoresMultiplicacion(expresion);
                const otrosFactores = factores.filter(f => f !== variableObjetivo);
                if (otrosFactores.length === 0) return variableDespejada;
                else if (otrosFactores.length === 1) return `(${variableDespejada}) / (${otrosFactores[0]})`;
                else return `(${variableDespejada}) / (${otrosFactores.join(' * ')})`;
            }

            if (expresion === variableObjetivo) return variableDespejada;
            return expresion;

        } catch (error) {
            return `Error: ${error.message}`;
        }
    }

    function despejarSumaResta(expresion, variableObjetivo, variableDespejada) {
        const terminos = parsearTerminos(expresion);
        let terminoConVariable = null;
        let otrosTerminos = [];
        for (const termino of terminos) {
            if (termino.texto.includes(variableObjetivo)) terminoConVariable = termino;
            else otrosTerminos.push(termino);
        }
        if (!terminoConVariable) return null;

        let resultado = variableDespejada;
        for (const termino of otrosTerminos) {
            const signoInverso = termino.signo === '+' ? '-' : '+';
            resultado += ` ${signoInverso} ${termino.texto}`;
        }

        if (terminoConVariable.texto !== variableObjetivo) {
            if (terminoConVariable.texto.includes('*')) {
                const partes = terminoConVariable.texto.split('*');
                const coef = partes.find(p => p !== variableObjetivo);
                resultado = `(${resultado}) / (${coef})`;
            }
        }
        if (terminoConVariable.signo === '-') resultado = `-(${resultado})`;
        return resultado;
    }

    function parsearTerminos(expresion) {
        const terminos = [];
        let actual = '';
        let signo = '+';
        let nivel = 0;
        for (let i = 0; i < expresion.length; i++) {
            const char = expresion[i];
            if (char === '(') { nivel++; actual += char; }
            else if (char === ')') { nivel--; actual += char; }
            else if ((char === '+' || char === '-') && nivel === 0 && actual !== '') {
                terminos.push({ signo: signo, texto: actual });
                signo = char;
                actual = '';
            } else if ((char === '+' || char === '-') && nivel === 0 && actual === '') {
                signo = char;
            } else {
                actual += char;
            }
        }
        if (actual) terminos.push({ signo: signo, texto: actual });
        return terminos;
    }

    function dividirPorOperadorPrincipal(expresion, operador) {
        let nivel = 0;
        let ultimaPosicion = -1;
        for (let i = expresion.length - 1; i >= 0; i--) {
            const char = expresion[i];
            if (char === ')') nivel++;
            else if (char === '(') nivel--;
            else if (char === operador && nivel === 0) {
                ultimaPosicion = i;
                break;
            }
        }
        if (ultimaPosicion === -1) return [expresion];
        const parte1 = expresion.substring(0, ultimaPosicion);
        const parte2 = expresion.substring(ultimaPosicion + 1);
        return [parte1, parte2];
    }

    function extraerFactoresMultiplicacion(expresion) {
        const factores = [];
        let actual = '';
        let nivel = 0;
        for (let i = 0; i < expresion.length; i++) {
            const char = expresion[i];
            if (char === '(') { nivel++; actual += char; }
            else if (char === ')') { nivel--; actual += char; }
            else if (char === '*' && nivel === 0) {
                if (actual) { factores.push(actual); actual = ''; }
            } else {
                actual += char;
            }
        }
        if (actual) factores.push(actual);
        return factores;
    }

    function procesarFormulaLiteral() {
        const formulaStr = document.getElementById('formulaLiteral').value;
        const resBox = document.getElementById('resFormulaLiteral');
        const errorBox = document.getElementById('mensajeErrorFormula');

        resBox.innerHTML = '';
        errorBox.innerText = '';

        try {
            const partes = formulaStr.split('=');
            if (partes.length !== 2) throw new Error("La fórmula debe contener exactamente un signo '='");

            const ladoIzq = partes[0].trim();
            const ladoDer = partes[1].trim();
            const variables = extractVariables(formulaStr);

            if (variables.length < 2) throw new Error("Se necesitan al menos 2 variables distintas en la fórmula");

            let htmlTable = `
                <div class="formula-original">
                    <strong>Fórmula Original:</strong> ${formulaStr}
                </div>
                <p><strong>Variables detectadas:</strong> ${variables.join(', ')}</p>
                <table>
                    <thead>
                        <tr>
                            <th>Variable Despejada</th>
                            <th>Fórmula Resultante</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            for (const variable of variables) {
                let formulaDespejada;
                if (ladoIzq === variable) {
                    formulaDespejada = `${variable} = ${ladoDer}`;
                } else {
                    const resultado = despejarVariable(ladoDer, variable, ladoIzq);
                    formulaDespejada = `${variable} = ${resultado}`;
                }
                htmlTable += `
                    <tr>
                        <td style="color:#B4141E; font-weight:bold;">${variable}</td>
                        <td><pre>${formulaDespejada}</pre></td>
                    </tr>
                `;
            }

            htmlTable += `
                    </tbody>
                </table>
                <div class="nota-didactica">
                    <strong>Nota:</strong> Los despejes son generados usando manipulación algebraica directa.
                </div>
            `;
            resBox.innerHTML = htmlTable;

        } catch (error) {
            errorBox.innerText = `Error: ${error.message}`;
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        resolverEcuacionParseada();
    });
</script>
</body>
</html>